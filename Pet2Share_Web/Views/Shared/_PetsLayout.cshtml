<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>@ViewBag.Title</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="@Url.Content("~/bootstrap/css/bootstrap.min.css")">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="@Url.Content("~/dist/css/AdminLTE.min.css")">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="@Url.Content("~/dist/css/skins/_all-skins.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/plugins/datepicker/datepicker3.css")">
    <link href="@Url.Content("~/Content/ImageArea.css" )" rel="stylesheet" />

    <link href="@Url.Content("~/Scripts/dropzone/basic.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Scripts/dropzone/dropzone.css")" rel="stylesheet" />
    <link href="@Url.Content("~/dist/css/bootstrap-select.min.css")" rel="stylesheet" />
    <!-- jQuery 2.1.4 -->
    <script src="@Url.Content("~/plugins/jQuery/jQuery-2.1.4.min.js")"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


    <style>
        .input-validation-error {
            border-color: red !important;
        }

        .field-validation-error {
            color: red !important;
        }

        #dropZone {
            background: gray;
            border: black dashed 3px;
            width: 200px;
            padding: 50px;
            text-align: center;
            color: white;
        }

        #dropzonePreview {
            cursor: pointer;
            border: 2px solid rgba(0, 0, 0, 0.3);
            margin: 0 0 0 0;
            margin-top: 12px;
        }
    </style>
</head>
<body class="hold-transition skin-blue-light layout-boxed sidebar-mini">
    <div class="wrapper">

        <header class="main-header">
            <!-- Logo -->
            <a href="@(User.Identity.IsAuthenticated ? Url.Action("Index", "Profile") : @Url.Action("Index"))" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><b>P2S</b></span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><b>Pet 2 Share</b></span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">

                        <!-- User Account: style can be found in dropdown.less -->
                        @if (User.Identity.IsAuthenticated)
                        {
                            <li class="dropdown messages-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" onclick="loadUserConnects(); return false;">
                                    <i class="ion ion-person-add" style="font-size: 17px;"></i>
                                    <span class="label label-success" id="reqCount"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="header">
                                        <p id="noReqElement" class="text-muted text-center">No Requests</p>
                                        <p id="Reqloading" class="text-center"><img width="16px" src="@Url.Content("~/Content/loading.gif")"></p>


                                    </li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu" id="connectsRequest"></ul>

                                    </li>

                                </ul>
                            </li>
                            @Html.Partial("_HeaderPetList")
                            <li class="dropdown user user-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <img src="@Pet2Share_Web.BL.FormatText.Instance.GetValidImage(Pet2Share_Web.BL.BLAuth.Instance.GetProfilePic(), false, Pet2Share_Web.BL.FormatText.CommonThumbnail)" class="user-image" alt="User Image">
                                    <span class="hidden-xs">&nbsp;</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <!-- User image -->
                                    <li class="user-header">
                                        <img style="cursor:pointer" title="Click to upload new profile pic" data-toggle="modal" data-target=".bs-modal-lg" onclick="LoadUploadModal(@Pet2Share_Web.BL.BLAuth.Instance.GetUserID(),1,0)" src="@Pet2Share_Web.BL.FormatText.Instance.GetValidImage(Pet2Share_Web.BL.BLAuth.Instance.GetProfilePic(), false, Pet2Share_Web.BL.FormatText.CommonThumbnail)" class="img-circle" alt="User Image">
                                        <p>
                                            @Pet2Share_Web.BL.BLAuth.Instance.GetFullName()

                                        </p>
                                    </li>
                                    <!-- Menu Body -->

                                    <!-- Menu Footer-->
                                    <li class="user-footer">
                                        <div class="pull-left">

                                            <a href="@Url.Action("Index","Profile")" class="btn btn-default btn-flat">Profile</a>
                                        </div>
                                        <div class="pull-right">
                                            <a href="@Url.Action("LogOut", "Index")" class="btn btn-default btn-flat">Sign out</a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <!-- Control Sidebar Toggle Button -->
                            @*<li>
                                    <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                                </li>*@
                        }
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- Sidebar user panel -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="@Pet2Share_Web.BL.FormatText.Instance.GetValidImage(Pet2Share_Web.BL.BLPetCookie.Instance.GetCurrentPetProfilePic(), false, Pet2Share_Web.BL.FormatText.Thumbnail128x128Carve)" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        <p>
                            <a href="@Pet2Share_Web.BL.BLAuth.Instance.GetProfileUrl(this.Url,Pet2Share_Web.BL.BLPetCookie.Instance.GetCurrentPetId(),true)">
                                @Pet2Share_Web.BL.BLPetCookie.Instance.GetCurrentPetName()

                            </a>
                        </p>
                        <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
                    </div>
                </div>
                <!-- search form -->

                <!-- /.search form -->
                <!-- sidebar menu: : style can be found in sidebar.less -->
                @Html.Partial("MenuPet")
            </section>
            <!-- /.sidebar -->

        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">

            @RenderBody()

        </div><!-- /.content-wrapper -->
        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Version</b> 2.3.0
            </div>
            <strong>Copyright &copy; 2015-2016 <a href="http://pet2share.com">Pet2Share</a>.</strong> All rights reserved.
        </footer>

        <!-- Control Sidebar -->


    </div><!-- ./wrapper -->
    <div class="modal bs-modal-lg" id="myModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">@*<span aria-hidden="true">×</span>*@</button>
                    <h4 class="modal-title">Upload</h4>
                </div>
                <div class="modal-body" id="tn_select">

                </div>
                <div class="modal-footer">
                    @*<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>*@
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!-- Bootstrap 3.3.5 -->
    <script src="@Url.Content("~/bootstrap/js/bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery-migrate-1.2.1.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")"></script>
    <!-- FastClick -->
    <script src="~/plugins/fastclick/fastclick.min.js" )"></script>
    <!-- AdminLTE App -->
    <script src="@Url.Content("~/dist/js/app.min.js" )"></script>
    <script src="@Url.Content("~/plugins/input-mask/jquery.inputmask.js" )"></script>
    <script src="@Url.Content("~/plugins/input-mask/jquery.inputmask.extensions.js" )"></script>
    <script src="@Url.Content("~/plugins/datepicker/bootstrap-datepicker.js" )"></script>
    <script src="@Url.Content("~/dist/js/bootstrap-select.min.js" )"></script>
    @Scripts.Render("~/bundles/dropzonescripts")
    <script src="@Url.Content("~/Scripts/jquery.imgareaselect.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.fancyupload.js")"></script>
    <script>
        $('.datepicker').datepicker({ format: 'mm/dd/yyyy' });
        $(".phonemask").inputmask("(999) 999-9999", { "placeholder": "(___) ___-____" });

    </script>
    <script>
        $(function () {

            String.prototype.format = function () {
                var str = this;
                for (var i = 0; i < arguments.length; i++) {
                    var reg = new RegExp("\\{" + i + "\\}", "gm");
                    str = str.replace(reg, arguments[i]);
                }
                return str;
            }
        });
        function LoadUploadModal(ProfileId, User, Cover) {
            //  $('.modal').show();

            var context = $('#tn_select').load('/Upload/UploadImage/{0}/{1}/{2}'.format(ProfileId, User, Cover), function () {
                initSelect(context, Cover);
            });
            // e.preventDefault();

        }

        $('#myModal').on('hidden.bs.modal', function (e) {
            // do something...
            $('#tn_select').empty();
            //$('div[class^=imgareaselect-]').remove();
            //$('div[class^=undefined-]').remove();
        });
        $.fn.pressEnter = function (fn) {

            return this.each(function () {
                $(this).bind('enterPress', fn);
                $(this).keyup(function (e) {
                    if (e.keyCode == 13) {
                        $(this).trigger("enterPress");
                    }
                })
            });
        };

        $(function () {
            loadUserConnects();

        });

        function loadUserConnects() {
            try {

                var count = 0;

                $('p#Reqloading').show();
                $.get("/Connection/GetUserConnects?id=" + @Pet2Share_Web.BL.BLPetCookie.Instance.GetCurrentPetId() +"&isPet=true", function (data) {

                    if (data != '') {
                        $("#reqCount").text("");
                        $("#connectsRequest").empty();
                        $("#connectsRequest").append(data);
                        $('p#noReqElement').hide();
                        count += $(data).find("a").length;
                        UpdateConnectRequestCount(count)
                    }

                    $('p#Reqloading').hide();

                }).fail(function () {
                    $('p#Reqloading').hide();

                    //setTimeout(function () {
                    //    loadUserConnects();
                    //}, 5000);
                });

            }
            catch (ex) {
                $('p#Reqloading').hide();
                //_inCallback = false;
                //setTimeout(function () {
                //    loadFeed();
                //}, 5000);
            }


        }

        @*function loadPetsConnects(Ucount) {
            try {

                var pcount = 0;

                $('p#Reqloading').show();
                $.get("/Connection/GetPetConnects?id=" + @Pet2Share_Web.BL.BLAuth.Instance.GetUserID() +"&isPet=false", function (data) {
                    debugger;
                    if (data != '') {
                        $("#petConnectsRequest").empty();
                        $("#petConnectsRequest").append(data);
                        $('p#noReqElement').hide();
                        pcount += $(data).find("a").length;
                        UpdateConnectRequestCount(pcount + Ucount);
                    }

                    $('p#Reqloading').hide();

                }).fail(function () {
                    $('p#Reqloading').hide();
                    //setTimeout(function () {
                    //    loadUserConnects();
                    //}, 5000);
                });

            }
            catch (ex) {
                $('p#Reqloading').hide();
                //_inCallback = false;
                //setTimeout(function () {
                //    loadFeed();
                //}, 5000);
            }

        }*@


        function UpdateConnectRequestCount(Count) {
            try {
                debugger;
                var totalCount = 0;
                if (isNaN(parseInt($("#reqCount").text(), 10))) {
                    totalCount = 0;
                } else {
                    totalCount = parseInt($("#reqCount").text(), 10);
                }
                totalCount = Count;
                $('#reqCount').text(totalCount);
            }
            catch (Ex)
            { }
        }
    </script>
    <script>
        //File Upload response from the server
        Dropzone.options.dropzoneForm = {
            maxFiles: 1,
            autoProcessQueue: false,
            maxFilesize: 7,
            addRemoveLinks: true,
            acceptedFiles: "image/*",
            clickable: "#dropzonePreview",
            previewsContainer: "#dzthumbPrev",
            init: function () {
                this.on("complete", function (data) {
                    debugger;
                    //var res = eval('(' + data.xhr.responseText + ')');
                    if (data.xhr != undefined || data.xhr != null) {
                        var res = JSON.parse(data.xhr.responseText);
                        if (res.Error == undefined || res.Error == null) {
                            window.location.href = res.Message;
                        }
                        else {
                            alert(res.Message);
                        }
                    } else {
                        // alert("");
                    }

                });

                this.on("addedfile", function (file) {

                    // Capture the Dropzone instance as closure.
                    var _this = this;
                    // First change the button to actually tell Dropzone to process the queue.
                    this.element.querySelector("button[type=submit]").addEventListener("click", function (e) {
                        if ($("#dropzoneForm").valid()) {
                            $("#hdnPostPrivacyId").val($('.selectpicker').val());
                            // Make sure that the form isn't actually being sent.
                            e.preventDefault();
                            e.stopPropagation();
                            _this.processQueue();
                        }

                    });


                });

            }
        };

        $(function () {
            $('.selectpicker').selectpicker();
        });
    </script>
    <!-- adminlte for demo purposes
    <script src="../../dist/js/demo.js"></script>-->
</body>
</html>
